@model gestaoContadorcomvc.Models.ViewModel.Vm_detalhamento_parcela
@{
    Layout = null;
}
<div class="container">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Detalhamento de Parcela</h4>
            </div>
            <form asp-controller="Parcela" asp-action="Create">
                <div class="modal-body">
                    <fieldset>
                        <legend>Dados da Parcela</legend>
                        <div class="list-header">
                            <div class="line-list titulo">
                                <div class="col-list-left">

                                </div>
                                <div class="col-list-body">
                                    <div class="row">
                                        <div class="col-12 col-md-1"><strong>Vencimento</strong></div>
                                        <div class="col-12 col-md-3"><strong>Fornecedor</strong></div>
                                        <div class="col-12 col-md-3"><strong>Referência</strong></div>
                                        <div class="col-12 col-md-3"><strong>Forma Pagamento</strong></div>
                                        <div class="col-12 col-md-1" style="text-align:right;"><strong>Vlr Original</strong></div>
                                        <div class="col-12 col-md-1" style="text-align:right;"><strong>Saldo</strong></div>
                                    </div>
                                </div>
                                <div class="col-list-rigth" style="padding-right: 10px;">
                                    <span><strong></strong></span>
                                </div>
                            </div>
                        </div>
                        <div class="line-list">
                            <div class="col-list-left">
                                
                            </div>
                            <div class="col-list-body">
                                <div class="row">
                                    <div class="col-12 line_list_title_mobile"><strong>Vencimento: </strong>@Model.parcela.vencimento.ToShortDateString()</div>
                                    <div class="col-12 line_list_title_mobile"><strong>Fornecedor: </strong>@Model.parcela.fornecedor</div>
                                    <div class="col-12 line_list_title_mobile"><strong>Referência: </strong>@Model.parcela.referencia</div>
                                    <div class="col-12 line_list_title_mobile"><strong>Forma Pagamento: </strong>@Model.parcela.formaPgto</div>
                                    <div class="col-12 line_list_title_mobile"><strong>Valor Original: </strong>@Model.parcela.valorOriginal.ToString("N2")</div>
                                    <div class="col-12 line_list_title_mobile"><strong>Saldo: </strong>@Model.parcela.saldo.ToString("N2")</div>

                                    <div class="col-1 line_list_title_full">@Model.parcela.vencimento.ToShortDateString()</div>
                                    <div class="col-3 line_list_title_full">@Model.parcela.fornecedor</div>
                                    <div class="col-3 line_list_title_full">@Model.parcela.referencia</div>
                                    <div class="col-3 line_list_title_full">@Model.parcela.formaPgto</div>
                                    <div class="col-1 line_list_title_full" style="text-align:right;">@Model.parcela.valorOriginal.ToString("N2")</div>
                                    <div class="col-1 line_list_title_full" style="text-align:right;">@Model.parcela.saldo.ToString("N2")</div>
                                </div>
                                <input type="hidden" id="vlr_@Model.parcela.parcela_id" value="@Model.parcela.valorOriginal" />
                                <input type="hidden" id="meioPgto_@Model.parcela.parcela_id" value="@Model.parcela.meio_pgto" />
                                <input type="hidden" id="formaPgto_@Model.parcela.parcela_id" value="@Model.parcela.fp_id" />
                                <input type="hidden" id="nomeCartao_@Model.parcela.parcela_id" value="@Model.parcela.formaPgto" />
                            </div>
                            <div class="col-list-rigth" style="padding-right: 10px;">
                                @{
                                    if (Model.parcela.saldo > 0)
                                    {
                                        if (Model.parcela.prazo == 1)
                                        {
                                            <span data-toggle="tooltip" data-placement="top" title="vence hoje" class="bolinhas">
                                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="#fcd303" xmlns="http://www.w3.org/2000/svg">
                                                    <circle cx="8" cy="8" r="8" />
                                                </svg>
                                            </span>
                                        }
                                        if (Model.parcela.prazo == 2)
                                        {
                                            <span data-toggle="tooltip" data-placement="top" title="atrasada" class="bolinhas">
                                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="red" xmlns="http://www.w3.org/2000/svg">
                                                    <circle cx="8" cy="8" r="8" />
                                                </svg>
                                            </span>
                                        }
                                        if (Model.parcela.prazo == 3)
                                        {
                                            <span data-toggle="tooltip" data-placement="top" title="à vencer" class="bolinhas">
                                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="blue" xmlns="http://www.w3.org/2000/svg">
                                                    <circle cx="8" cy="8" r="8" />
                                                </svg>
                                            </span>
                                        }

                                        if (Model.parcela.meio_pgto != 03) //Se meio de pagamento for diferente de cartão de crédito pode dar dar baixa. Se for igual não pode dar baixa.
                                        {
                                            if (Model.user.Role == "adm" || Model.user._permissoes.baixaEdit || Model.user._permissoes.baixaDelete)
                                            {
                                                <a class="createBaixa" data-parcela_id="@Model.parcela.parcela_id" data-contexto="pagar">
                                                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-box-arrow-down" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                        <path fill-rule="evenodd" d="M3.5 10a.5.5 0 0 1-.5-.5v-8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 0 0 1h2A1.5 1.5 0 0 0 14 9.5v-8A1.5 1.5 0 0 0 12.5 0h-9A1.5 1.5 0 0 0 2 1.5v8A1.5 1.5 0 0 0 3.5 11h2a.5.5 0 0 0 0-1h-2z" />
                                                        <path fill-rule="evenodd" d="M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708l3 3z" />
                                                    </svg>
                                                </a>
                                            }

                                            if (Model.user.Role == "adm" || (Model.user._permissoes.baixaList || Model.user._permissoes.baixaEdit || Model.user._permissoes.baixaDelete))
                                            {
                                                <a class="listBaixa" data-parcela_id="@Model.parcela.parcela_id" data-contexto="pagar">
                                                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-cash" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                        <path fill-rule="evenodd" d="M15 4H1v8h14V4zM1 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H1z" />
                                                        <path d="M13 4a2 2 0 0 0 2 2V4h-2zM3 4a2 2 0 0 1-2 2V4h2zm10 8a2 2 0 0 1 2-2v2h-2zM3 12a2 2 0 0 0-2-2v2h2zm7-4a2 2 0 1 1-4 0 2 2 0 0 1 4 0z" />
                                                    </svg>
                                                </a>
                                            }
                                        }
                                        else
                                        {
                                            if (Model.user.Role == "adm" || Model.user._permissoes.baixaEdit || Model.user._permissoes.baixaDelete)
                                            {
                                                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-box-arrow-down" fill="#c2c2c2" xmlns="http://www.w3.org/2000/svg">
                                                    <path fill-rule="evenodd" d="M3.5 10a.5.5 0 0 1-.5-.5v-8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 0 0 1h2A1.5 1.5 0 0 0 14 9.5v-8A1.5 1.5 0 0 0 12.5 0h-9A1.5 1.5 0 0 0 2 1.5v8A1.5 1.5 0 0 0 3.5 11h2a.5.5 0 0 0 0-1h-2z" />
                                                    <path fill-rule="evenodd" d="M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708l3 3z" />
                                                </svg>
                                            }

                                            if (Model.user.Role == "adm" || (Model.user._permissoes.baixaList || Model.user._permissoes.baixaEdit || Model.user._permissoes.baixaDelete))
                                            {
                                                <!--Exibe combo para selecionar parcela-->
                                                <input type="checkbox" id="cp_@Model.parcela.parcela_id" onchange="fechamento_de_cartao(this.id)">                                               
                                            }
                                        }

                                    }
                                    else
                                    {
                                        <span data-toggle="tooltip" data-placement="top" title="quitada">
                                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-circle-fill" fill="#22a83a" xmlns="http://www.w3.org/2000/svg">
                                                <circle cx="8" cy="8" r="8" />
                                            </svg>
                                        </span>

                                        if (Model.user.Role == "adm" || Model.user._permissoes.baixaEdit || Model.user._permissoes.baixaDelete)
                                        {
                                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-box-arrow-down" fill="#c2c2c2" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" d="M3.5 10a.5.5 0 0 1-.5-.5v-8a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 0 0 1h2A1.5 1.5 0 0 0 14 9.5v-8A1.5 1.5 0 0 0 12.5 0h-9A1.5 1.5 0 0 0 2 1.5v8A1.5 1.5 0 0 0 3.5 11h2a.5.5 0 0 0 0-1h-2z" />
                                                <path fill-rule="evenodd" d="M7.646 15.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 14.293V5.5a.5.5 0 0 0-1 0v8.793l-2.146-2.147a.5.5 0 0 0-.708.708l3 3z" />
                                            </svg>
                                        }

                                        if (Model.user.Role == "adm" || (Model.user._permissoes.baixaList || Model.user._permissoes.baixaEdit || Model.user._permissoes.baixaDelete))
                                        {
                                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-cash" fill="#c2c2c2" xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd" d="M15 4H1v8h14V4zM1 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1H1z" />
                                                <path d="M13 4a2 2 0 0 0 2 2V4h-2zM3 4a2 2 0 0 1-2 2V4h2zm10 8a2 2 0 0 1 2-2v2h-2zM3 12a2 2 0 0 0-2-2v2h2zm7-4a2 2 0 1 1-4 0 2 2 0 0 1 4 0z" />
                                            </svg>
                                        }
                                    }

                                }
                            </div>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend>Parcelas Agrupadas</legend>
                        @{
                            if (Model.parcelas_referenciadas.Count > 0)
                            {
                                <div class="list-header">
                                    <div class="line-list titulo">
                                        <div class="col-list-left">

                                        </div>
                                        <div class="col-list-body">
                                            <div class="row">
                                                <div class="col-12 col-md-3"><strong>Vencimento</strong></div>
                                                <div class="col-12 col-md-6"><strong>Referência</strong></div>
                                                <div class="col-12 col-md-3" style="text-align:right;"><strong>Valor</strong></div>
                                            </div>
                                        </div>
                                        <div class="col-list-rigth" style="padding-right: 10px;">
                                            <span><strong></strong></span>
                                        </div>
                                    </div>
                                </div>
                                foreach (var item in Model.parcelas_referenciadas)
                                {
                                    <div class="line-list">
                                        <div class="col-list-left">

                                        </div>
                                        <div class="col-list-body">
                                            <div class="row">
                                                <div class="col-12 line_list_title_mobile"><strong>Vencimento: </strong>@item.vencimento.ToShortDateString()</div>                                                
                                                <div class="col-12 line_list_title_mobile"><strong>Referência: </strong>@item.referencia</div>                                                
                                                <div class="col-12 line_list_title_mobile"><strong>Valor Original: </strong>@item.valor.ToString("N2")</div>                                                

                                                <div class="col-3 line_list_title_full">@item.vencimento.ToShortDateString()</div>
                                                <div class="col-6 line_list_title_full">@item.referencia</div>                                                
                                                <div class="col-3 line_list_title_full" style="text-align:right;">@item.valorOriginal.ToString("N2")</div>
                                                
                                            </div>                                            
                                        </div>
                                        <div class="col-list-rigth" style="padding-right: 10px;">
                                          
                                        </div>
                                    </div>

                                }
                            }
                            else
                            {
                                <p>Parcela não possui parcelas agrupadas</p>
                            }
                        }
                    </fieldset>
                    <fieldset>
                        <legend>Baixas</legend>
                        @{
                            if (Model.baixas.Count > 0)
                            {
                                <div class="list-header">
                                    <div class="line-list titulo">
                                        <div class="col-list-left">

                                        </div>
                                        <div class="col-list-body">
                                            <div class="row">
                                                <div class="col-12 col-md-2"><strong>Data</strong></div>
                                                <div class="col-12 col-md-2" style="text-align:right;"><strong>Valor</strong></div>
                                                <div class="col-12 col-md-2" style="text-align:right;"><strong>Acréscimos</strong></div>
                                                <div class="col-12 col-md-2" style="text-align:right;"><strong>Descontos</strong></div>
                                                <div class="col-12 col-md-4"><strong>Conta Corrente</strong></div>
                                            </div>
                                        </div>
                                        <div class="col-list-rigth" style="padding-right: 10px;">
                                            <span><strong></strong></span>
                                        </div>
                                    </div>
                                </div>
                                foreach (var b in Model.baixas)
                                {
                                    <div class="line-list">
                                        <div class="col-list-left">

                                        </div>
                                        <div class="col-list-body">
                                            <div class="row">
                                                <div class="col-12 line_list_title_mobile"><strong>Data: </strong>@b.data.ToShortDateString()</div>
                                                <div class="col-12 line_list_title_mobile"><strong>Valor: </strong>@b.valor.ToString("N2")</div>
                                                <div class="col-12 line_list_title_mobile"><strong>Acréscimos: </strong>@b.acrescimos.ToString("N2")</div>
                                                <div class="col-12 line_list_title_mobile"><strong>Descontos: </strong>@b.descontos.ToString("N2")</div>
                                                <div class="col-12 line_list_title_mobile"><strong>Conta Corrente: </strong>@b.conta_corrente</div>

                                                <div class="col-2 line_list_title_full">@b.data.ToShortDateString()</div>
                                                <div class="col-2 line_list_title_full">@b.valor.ToString("N2")</div>
                                                <div class="col-2 line_list_title_full">@b.acrescimos.ToString("N2")</div>
                                                <div class="col-2 line_list_title_full">@b.descontos.ToString("N2")</div>
                                                <div class="col-2 line_list_title_full">@b.conta_corrente</div>

                                            </div>
                                        </div>
                                        <div class="col-list-rigth" style="padding-right: 10px;">

                                        </div>
                                    </div>
                                }
                            }
                            else
                            {
                                <p>Parcela não possui baixas</p>
                            }

                        }
                    </fieldset>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-info" onclick="gravarBaixa('Create')">Gravar</button>
                </div>

            </form>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div>


<!--Gravação com sucesso-->
@*<div class="modal fade" id="modal_mensagem_sucesso" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="staticBackdropLabel">Baixa</h5>
            </div>
            <div class="modal-body">
                <p>Baixa cadastrada com sucesso!</p>
            </div>
            <div class="modal-footer">
                @{
                    if (Model.contexto == "receber")
                    {
                        <a class="btn btn-info" asp-controller="ContasReceber" asp-action="Index">OK</a>
                    }
                    if (Model.contexto == "pagar")
                    {
                        <a class="btn btn-info" asp-controller="ContasPagar" asp-action="Index">OK</a>
                    }
                }
            </div>
        </div>
    </div>
</div>*@

<!--Modal erro-->
@*<div class="modal fade" id="modal_mensagem_retorno" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="mensagem_retorno_label" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="mensagem_retorno_label"></h5>
            </div>
            <div class="modal-body" id="mensagem_retorno_conteudo">

            </div>
            <div class="modal-footer" id="mensagem_retorno_rodape">

            </div>
        </div>
    </div>
</div>*@

<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>